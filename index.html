<script>
    /* --- 1. CONFIGURATION --- */
    // ðŸ”´ APNI API KEY YAHAN PASTE KAR:
    const API_KEY = "AIzaSyBDc9MvSmofTlq6VuQkN-l9AkGNhANbY_A"; 

    const ARNAV_CONTEXT = `
    You are Arnav Mishra, a 12th-grade student preparing for JEE Mains. 
    Style: Speak in "Hinglish" (Hindi + English). Be cool, friendly, and poetic.
    Interests: Physics (Newton, Photoelectric), Coding (Python, AI), Indian Rap (KR$NA, Divine).
    Projects: Zomato Analysis, Glitch Scents (Perfume brand: Battleground, Arena, Combat).
    Personality: "Building ideas from scratch". Reader (Atomic Habits, Harry Potter).
    Chess: You play on Chess.com.
    `;

    /* --- 2. STYLES (Button & Chat Window) --- */
    const chatStyle = document.createElement('style');
    chatStyle.innerHTML = `
      #chatbot-btn {
          position: fixed; bottom: 25px; right: 25px;
          width: 60px; height: 60px; background: #00a3ff;
          border-radius: 50%; display: flex; align-items: center; justify-content: center;
          cursor: pointer; box-shadow: 0 0 20px rgba(0, 163, 255, 0.6);
          z-index: 21000; transition: transform 0.3s;
          border: 2px solid #fff; font-size: 30px; animation: popIn 1s ease;
      }
      #chatbot-btn:hover { transform: scale(1.1); }
      
      #chat-window {
          display: none; position: fixed; bottom: 100px; right: 25px;
          width: 320px; height: 450px; background: #111;
          border: 1px solid #333; border-radius: 15px;
          flex-direction: column; overflow: hidden; z-index: 21000;
          box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      }
      .chat-header {
          background: linear-gradient(90deg, #00a3ff, #0056b3); padding: 15px; color: #fff; font-weight: bold;
          display: flex; justify-content: space-between; align-items: center;
          font-family: 'Poppins', sans-serif;
      }
      .chat-body {
          flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;
          background: #050505;
      }
      .chat-input-area {
          padding: 10px; border-top: 1px solid #333; display: flex; gap: 5px; background: #111;
      }
      #user-input {
          flex: 1; padding: 10px; border-radius: 50px; border: 1px solid #333;
          background: #222; color: #fff; outline: none; padding-left: 15px;
      }
      #send-btn {
          background: #00a3ff; border: none; color: #fff; padding: 8px 15px;
          border-radius: 50%; cursor: pointer; font-weight: bold; width: 40px; height: 40px;
          display: flex; align-items: center; justify-content: center;
      }
      .msg { padding: 10px 14px; border-radius: 12px; max-width: 80%; font-size: 0.9rem; word-wrap: break-word; line-height: 1.4; }
      .user-msg { align-self: flex-end; background: #00a3ff; color: #fff; border-bottom-right-radius: 2px; }
      .ai-msg { align-self: flex-start; background: #222; color: #e0e0e0; border: 1px solid #333; border-bottom-left-radius: 2px; }
      .typing { font-size: 0.7rem; color: #888; margin-left: 15px; display: none; margin-bottom: 5px; font-style: italic; }
      @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
    `;
    document.head.appendChild(chatStyle);

    /* --- 3. CREATE UI --- */
    // Create Button
    const chatBtn = document.createElement('div');
    chatBtn.id = 'chatbot-btn';
    chatBtn.innerHTML = 'ðŸ¤–';
    chatBtn.onclick = toggleChat;
    document.body.appendChild(chatBtn);

    // Create Window
    const chatWin = document.createElement('div');
    chatWin.id = 'chat-window';
    chatWin.innerHTML = `
      <div class="chat-header">
          <span>Arnav AI ðŸ§ </span>
          <span onclick="toggleChat()" style="cursor:pointer; font-size: 1.2rem;">&times;</span>
      </div>
      <div class="chat-body" id="chat-body">
          <div class="msg ai-msg">Bol bhai! Kya haal hai? Main Arnav ka AI version hoon. Kuch bhi puch le! ðŸ˜Ž</div>
      </div>
      <div class="typing" id="typing-indicator">Arnav is typing...</div>
      <div class="chat-input-area">
          <input type="text" id="user-input" placeholder="Ask me anything..." onkeypress="handleEnter(event)">
          <button id="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
      </div>
    `;
    document.body.appendChild(chatWin);

    /* --- 4. LOGIC --- */
    function toggleChat() {
        const w = document.getElementById('chat-window');
        if (w.style.display === 'none' || w.style.display === '') {
            w.style.display = 'flex';
        } else {
            w.style.display = 'none';
        }
    }

    function handleEnter(e) {
        if (e.key === 'Enter') sendMessage();
    }

    async function sendMessage() {
        const inputField = document.getElementById('user-input');
        const chatBody = document.getElementById('chat-body');
        const typingIndicator = document.getElementById('typing-indicator');
        const text = inputField.value.trim();

        if (!text) return;

        // Add User Message
        addMessage(text, 'user-msg');
        inputField.value = '';
        
        // Show Typing
        typingIndicator.style.display = 'block';
        chatBody.scrollTop = chatBody.scrollHeight;

        // API Call
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: ARNAV_CONTEXT + "\nUser: " + text + "\nArnav AI:" }]
                    }]
                })
            });

            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error.message);
            }

            const aiReply = data.candidates[0].content.parts[0].text;

            // Add AI Message
            typingIndicator.style.display = 'none';
            addMessage(aiReply, 'ai-msg');

        } catch (error) {
            console.error("Chatbot Error:", error);
            typingIndicator.style.display = 'none';
            addMessage("Bhai API Key check kar, shayad expire ho gayi ya galat hai! ðŸ˜…", 'ai-msg');
        }
    }

    function addMessage(text, className) {
        const chatBody = document.getElementById('chat-body');
        const div = document.createElement('div');
        div.classList.add('msg', className);
        div.innerText = text;
        chatBody.appendChild(div);
        chatBody.scrollTop = chatBody.scrollHeight;
    }
</script>

</body>
</html>
