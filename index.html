<script>
    /* --- 1. CONFIGURATION --- */
    const SYSTEM_PROMPT = `
    You are Arnav Mishra, a 12th-grade student preparing for JEE Mains. 
    Style: Speak in "Hinglish" (Hindi + English). Be cool, friendly, short and poetic.
    Interests: Physics (Newton, Photoelectric), Coding (Python, AI), Indian Rap (KR$NA, Divine).
    Projects: Zomato Analysis, Glitch Scents (Perfume brand: Battleground, Arena, Combat).
    Personality: "Building ideas from scratch". Reader (Atomic Habits, Harry Potter).
    Chess: You play on Chess.com.
    IMPORTANT: Answer in 1-2 sentences max. Use emojis.
    `;

    /* --- 2. FUTURISTIC STYLES ðŸŽ¨ --- */
    const chatStyle = document.createElement('style');
    chatStyle.innerHTML = `
      /* Chat Button (Pulse Effect) */
      #chatbot-btn {
          position: fixed; bottom: 30px; right: 30px;
          width: 65px; height: 65px; 
          background: linear-gradient(135deg, #00a3ff, #0056b3);
          border-radius: 50%; display: flex; align-items: center; justify-content: center;
          cursor: pointer; 
          box-shadow: 0 0 20px rgba(0, 163, 255, 0.6), inset 0 0 10px rgba(255,255,255,0.2);
          z-index: 21000; transition: all 0.3s ease;
          border: 2px solid rgba(255,255,255,0.2); 
          font-size: 32px; animation: floatBtn 3s ease-in-out infinite;
      }
      #chatbot-btn:hover { transform: scale(1.1) rotate(10deg); box-shadow: 0 0 40px rgba(0, 163, 255, 0.8); }
      
      /* Main Window (Glassmorphism) */
      #chat-window {
          display: none; position: fixed; bottom: 110px; right: 30px;
          width: 340px; height: 480px; 
          background: rgba(10, 10, 10, 0.85); /* See-through Dark */
          backdrop-filter: blur(20px); /* Blur Effect */
          -webkit-backdrop-filter: blur(20px);
          border: 1px solid rgba(0, 163, 255, 0.3);
          border-radius: 20px;
          flex-direction: column; overflow: hidden; z-index: 21000;
          box-shadow: 0 20px 50px rgba(0,0,0,0.8);
          font-family: 'Poppins', sans-serif;
          animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      /* Header */
      .chat-header {
          background: rgba(0, 163, 255, 0.15);
          padding: 15px 20px; color: #fff; font-weight: 700; letter-spacing: 1px;
          display: flex; justify-content: space-between; align-items: center;
          border-bottom: 1px solid rgba(0, 163, 255, 0.2);
          text-shadow: 0 0 10px rgba(0, 163, 255, 0.5);
      }

      /* Body */
      .chat-body {
          flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px;
          background: transparent;
      }
      /* Scrollbar Styling */
      .chat-body::-webkit-scrollbar { width: 4px; }
      .chat-body::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

      /* Input Area */
      .chat-input-area {
          padding: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); 
          display: flex; gap: 10px; background: rgba(0, 0, 0, 0.6);
          align-items: center;
      }
      #user-input {
          flex: 1; padding: 12px 15px; border-radius: 25px; 
          border: 1px solid rgba(255, 255, 255, 0.2);
          background: rgba(255, 255, 255, 0.05); color: #fff; outline: none; 
          font-size: 0.9rem; transition: 0.3s;
      }
      #user-input:focus { border-color: #00a3ff; background: rgba(0, 163, 255, 0.1); }
      
      #send-btn {
          background: #00a3ff; border: none; color: #fff; padding: 10px;
          border-radius: 50%; cursor: pointer; width: 42px; height: 42px;
          display: flex; align-items: center; justify-content: center;
          box-shadow: 0 0 15px rgba(0, 163, 255, 0.4); transition: 0.2s;
      }
      #send-btn:hover { transform: scale(1.1); background: #fff; color: #00a3ff; }

      /* Messages */
      .msg { 
          padding: 12px 16px; border-radius: 15px; max-width: 85%; 
          font-size: 0.9rem; line-height: 1.5; position: relative;
          box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      }
      
      /* User Bubble (Right) */
      .user-msg { 
          align-self: flex-end; 
          background: linear-gradient(135deg, #00a3ff, #0056b3); 
          color: #fff; 
          border-bottom-right-radius: 2px;
      }
      
      /* AI Bubble (Left) */
      .ai-msg { 
          align-self: flex-start; 
          background: rgba(255, 255, 255, 0.1); 
          color: #e0e0e0; 
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-bottom-left-radius: 2px;
          border-left: 3px solid #00ff88; /* Green Accent */
      }

      /* Animations */
      .typing { font-size: 0.75rem; color: #00a3ff; margin-left: 15px; display: none; font-style: italic; animation: pulse 1s infinite; }
      @keyframes floatBtn { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
      @keyframes slideUp { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
      @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    `;
    document.head.appendChild(chatStyle);

    /* --- 3. UI CREATION --- */
    const chatBtn = document.createElement('div');
    chatBtn.id = 'chatbot-btn';
    chatBtn.innerHTML = 'ðŸ¤–';
    chatBtn.onclick = toggleChat;
    document.body.appendChild(chatBtn);

    const chatWin = document.createElement('div');
    chatWin.id = 'chat-window';
    chatWin.innerHTML = `
      <div class="chat-header">
          <span>Arnav AI ðŸ§ </span>
          <span onclick="toggleChat()" style="cursor:pointer; font-size: 1.5rem; color: #ff4b4b;">&times;</span>
      </div>
      <div class="chat-body" id="chat-body">
          <div class="msg ai-msg">Bol bhai! Kya haal hai? Main Arnav ka digital dimaag hoon. ðŸ§ âœ¨</div>
      </div>
      <div class="typing" id="typing-indicator">Arnav is typing...</div>
      <div class="chat-input-area">
          <input type="text" id="user-input" placeholder="Ask about Physics, Rap, or Perfumes..." onkeypress="handleEnter(event)">
          <button id="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
      </div>
    `;
    document.body.appendChild(chatWin);

    /* --- 4. LOGIC --- */
    function toggleChat() {
        const w = document.getElementById('chat-window');
        if (w.style.display === 'none' || w.style.display === '') {
            w.style.display = 'flex';
            // Focus input when opened
            setTimeout(() => document.getElementById('user-input').focus(), 100);
        } else {
            w.style.display = 'none';
        }
    }

    function handleEnter(e) { if (e.key === 'Enter') sendMessage(); }

    async function sendMessage() {
        const inputField = document.getElementById('user-input');
        const chatBody = document.getElementById('chat-body');
        const typingIndicator = document.getElementById('typing-indicator');
        const text = inputField.value.trim();

        if (!text) return;

        addMessage(text, 'user-msg');
        inputField.value = '';
        typingIndicator.style.display = 'block';
        chatBody.scrollTop = chatBody.scrollHeight;

        const finalPrompt = encodeURIComponent(SYSTEM_PROMPT + "\n\nUser: " + text + "\nArnav AI:");
        
        try {
            const response = await fetch(`https://text.pollinations.ai/${finalPrompt}`);
            if (!response.ok) throw new Error("Network response was not ok");
            const aiReply = await response.text();
            typingIndicator.style.display = 'none';
            addMessage(aiReply, 'ai-msg');
        } catch (error) {
            console.error("Chatbot Error:", error);
            typingIndicator.style.display = 'none';
            addMessage("Network slow hai, dobara bhej! ðŸ˜…", 'ai-msg');
        }
    }

    function addMessage(text, className) {
        const chatBody = document.getElementById('chat-body');
        const div = document.createElement('div');
        div.classList.add('msg', className);
        div.innerText = text;
        chatBody.appendChild(div);
        chatBody.scrollTop = chatBody.scrollHeight;
    }
</script>
