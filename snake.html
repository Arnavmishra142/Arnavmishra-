<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arnav Verse | Neon Snake</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #050505; color: #fff;
            font-family: 'Rajdhani', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; overflow: hidden;
            background-image: radial-gradient(circle at center, #111 0%, #000 100%);
            touch-action: none; /* Prevent scroll on mobile */
        }

        /* --- BOT PROFILE --- */
        .opponent-area {
            display: flex; align-items: center; gap: 20px; margin-bottom: 20px;
            width: 350px; padding: 10px;
            background: rgba(20, 20, 20, 0.8); border: 1px solid #333;
            border-left: 4px solid #00ff88; border-radius: 0 10px 10px 0;
            backdrop-filter: blur(5px);
        }
        .bot-avatar {
            width: 50px; height: 50px; border-radius: 10px; background: #000;
            border: 2px solid #00ff88; display: flex; align-items: center; justify-content: center;
            font-size: 25px; color: #00ff88; box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        .bot-info h3 { margin: 0; font-size: 1.1rem; color: #fff; text-transform: uppercase; }
        .score-box { font-size: 0.9rem; color: #888; }
        .highlight { color: #00ff88; font-weight: bold; }
        
        .speech-bubble {
            margin-top: 5px; font-size: 0.8rem; color: #00ff88; font-style: italic; min-height: 20px;
        }

        /* --- GAME BOARD --- */
        canvas {
            background: #000;
            border: 2px solid #333;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.15);
            display: block;
        }

        /* --- CONTROLS --- */
        .controls { margin-top: 20px; display: flex; gap: 15px; }
        .btn {
            background: transparent; border: 1px solid #00a3ff; color: #00a3ff;
            padding: 8px 20px; cursor: pointer; text-transform: uppercase; font-weight: bold;
            text-decoration: none; transition: 0.3s; font-family: 'Orbitron', sans-serif; font-size: 0.8rem;
        }
        .btn:hover { background: #00a3ff; color: #000; }
        .btn-exit { border-color: #ff4b4b; color: #ff4b4b; }
        .btn-exit:hover { background: #ff4b4b; color: #fff; }

        /* Mobile D-Pad */
        .mobile-controls {
            display: none; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 15px;
        }
        .d-btn {
            width: 50px; height: 50px; background: rgba(255,255,255,0.1); border: 1px solid #333;
            color: #fff; border-radius: 5px; font-size: 1.2rem; cursor: pointer;
        }
        .d-btn:active { background: #00ff88; color: #000; }

        @media (max-width: 600px) {
            canvas { width: 340px; height: 340px; }
            .mobile-controls { display: grid; }
            .opponent-area { width: 340px; }
        }
    </style>
</head>
<body>

    <div class="opponent-area">
        <div class="bot-avatar"><i class="fas fa-robot"></i></div>
        <div class="bot-info">
            <h3>Arnav's Bot</h3>
            <div class="score-box">SCORE: <span id="score" class="highlight">0</span> | HIGH: <span id="high-score">0</span></div>
            <div class="speech-bubble" id="bot-msg">"Feed the snake. Don't die. üêç"</div>
        </div>
    </div>

    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div class="mobile-controls">
        <div></div>
        <button class="d-btn" onclick="changeDirection('UP')"><i class="fas fa-arrow-up"></i></button>
        <div></div>
        <button class="d-btn" onclick="changeDirection('LEFT')"><i class="fas fa-arrow-left"></i></button>
        <button class="d-btn" onclick="changeDirection('DOWN')"><i class="fas fa-arrow-down"></i></button>
        <button class="d-btn" onclick="changeDirection('RIGHT')"><i class="fas fa-arrow-right"></i></button>
    </div>

    <div class="controls">
        <a href="verse.html" class="btn btn-exit">Exit</a>
        <button class="btn" onclick="resetGame()">Start Game</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const box = 20; // Size of one square
        const canvasSize = 400;
        
        // Mobile scaling fix
        if(window.innerWidth < 600) {
            // Logic handled by CSS resize, canvas internal res remains 400 for logic
        }

        let snake = [];
        let food = {};
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        document.getElementById('high-score').innerText = highScore;

        let d; // Direction
        let game; // Interval
        let isGameRunning = false;

        // --- AUDIO ---
        // Simple beep creation using Web Audio API to avoid external files
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playBeep(freq, type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = type || 'sine';
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.1);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- DIALOGUES ---
        const dialogues = {
            start: ["Speed badhaun kya? üòè", "Let's see how long you last.", "Focus bro."],
            eat: ["Yummy. üçé", "Nice reflexes.", "Grow bigger!", "More!"],
            die: ["Diwaar swadisht thi? üß±", "Self-cannibalism is bad. üíÄ", "Score dekh ke rona aaya?", "Bruh... blunder."],
            highScore: ["New High Score! Not bad. üî•", "Hacker hai kya?", "Finally some skill."]
        };

        function speak(category) {
            const msgs = dialogues[category];
            const msg = msgs[Math.floor(Math.random() * msgs.length)];
            const el = document.getElementById('bot-msg');
            el.style.opacity = 0;
            setTimeout(() => { el.innerText = msg; el.style.opacity = 1; 
                if(category === 'die') el.style.color = '#ff4b4b';
                else if(category === 'eat') el.style.color = '#00ff88';
                else el.style.color = '#00a3ff';
            }, 100);
        }

        // --- CONTROLS ---
        document.addEventListener('keydown', direction);

        function direction(event) {
            if(event.keyCode == 37 && d != "RIGHT") d = "LEFT";
            else if(event.keyCode == 38 && d != "DOWN") d = "UP";
            else if(event.keyCode == 39 && d != "LEFT") d = "RIGHT";
            else if(event.keyCode == 40 && d != "UP") d = "DOWN";
        }
        
        function changeDirection(dir) {
            if(dir == "LEFT" && d != "RIGHT") d = "LEFT";
            else if(dir == "UP" && d != "DOWN") d = "UP";
            else if(dir == "RIGHT" && d != "LEFT") d = "RIGHT";
            else if(dir == "DOWN" && d != "UP") d = "DOWN";
        }

        function draw() {
            // Clear Screen
            ctx.fillStyle = "#050505";
            ctx.fillRect(0, 0, canvasSize, canvasSize);

            // Draw Grid (Optional Cyber effect)
            ctx.strokeStyle = "#111";
            for(let i=0; i<canvasSize; i+=box) {
                ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvasSize); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvasSize,i); ctx.stroke();
            }

            // Draw Snake
            for(let i = 0; i < snake.length; i++) {
                ctx.fillStyle = (i == 0) ? "#00ff88" : "#00a3ff"; // Head Green, Body Blue
                ctx.shadowBlur = (i==0) ? 15 : 0;
                ctx.shadowColor = "#00ff88";
                ctx.fillRect(snake[i].x, snake[i].y, box, box);
                
                ctx.strokeStyle = "#000";
                ctx.strokeRect(snake[i].x, snake[i].y, box, box);
                ctx.shadowBlur = 0; // Reset shadow
            }

            // Draw Food
            ctx.fillStyle = "#ff4b4b";
            ctx.shadowBlur = 15;
            ctx.shadowColor = "#ff4b4b";
            ctx.beginPath();
            ctx.arc(food.x + box/2, food.y + box/2, box/2.5, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;

            // Old Head Position
            let snakeX = snake[0].x;
            let snakeY = snake[0].y;

            // Direction Logic
            if(d == "LEFT") snakeX -= box;
            if(d == "UP") snakeY -= box;
            if(d == "RIGHT") snakeX += box;
            if(d == "DOWN") snakeY += box;

            // Eat Logic
            if(snakeX == food.x && snakeY == food.y) {
                score++;
                playBeep(600, 'square'); // Eat Sound
                speak("eat");
                document.getElementById('score').innerText = score;
                food = {
                    x: Math.floor(Math.random() * 19 + 1) * box,
                    y: Math.floor(Math.random() * 19 + 1) * box
                }
            } else {
                // Remove Tail
                snake.pop();
            }

            // Create new Head
            let newHead = { x: snakeX, y: snakeY };

            // Game Over Rules
            if(snakeX < 0 || snakeX >= canvasSize || snakeY < 0 || snakeY >= canvasSize || collision(newHead, snake)) {
                clearInterval(game);
                isGameRunning = false;
                playBeep(150, 'sawtooth'); // Die Sound
                speak("die");
                
                if(score > highScore) {
                    highScore = score;
                    localStorage.setItem('snakeHighScore', highScore);
                    document.getElementById('high-score').innerText = highScore;
                    speak("highScore");
                }
                return;
            }

            snake.unshift(newHead);
        }

        function collision(head, array) {
            for(let i = 0; i < array.length; i++) {
                if(head.x == array[i].x && head.y == array[i].y) {
                    return true;
                }
            }
            return false;
        }

        function resetGame() {
            if(isGameRunning) clearInterval(game);
            
            snake = [];
            snake[0] = { x: 9 * box, y: 10 * box };
            
            food = {
                x: Math.floor(Math.random() * 19 + 1) * box,
                y: Math.floor(Math.random() * 19 + 1) * box
            };
            
            score = 0;
            d = null; // Wait for input
            document.getElementById('score').innerText = 0;
            speak("start");
            
            game = setInterval(draw, 100); // 100ms speed
            isGameRunning = true;
        }

        // Draw initial screen
        ctx.fillStyle = "#050505";
        ctx.fillRect(0, 0, canvasSize, canvasSize);
        ctx.fillStyle = "#00ff88";
        ctx.font = "20px Orbitron";
        ctx.fillText("PRESS START", 120, 200);

    </script>
</body>
</html>
